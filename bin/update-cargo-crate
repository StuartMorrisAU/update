#!/bin/sh
set -euf

# Helpers https://github.com/sixarm/unix-shell-script-kit
. "$(dirname "$(readlink -f "$0")")/unix-shell-script-kit"

# Rust cargo package manager
if command_exists cargo; then
    # Is this command running inside a cargo project?
    if cargo check>/dev/null 2>&1; then 
        cargo update --aggressive
        cargo check --all-targets
        cargo build --all-targets
        cargo test --all-targets --no-run
        # Is "cargo upgrade" available?
        # If yes, then upgrade the Cargo.toml file.
        if cargo upgrade --help>/dev/null 2>&1; then
            cargo upgrade --recursive true
        fi
    fi
fi

#!/bin/sh
set -euf

# Helpers https://github.com/sixarm/unix-shell-script-kit
. "$(dirname "$(readlink -f "$0")")/unix-shell-script-kit"

# Update via Brewfile using the `brew` package manager.
#
# The brew documentation says to look for its file in order:
#
#     $HOMEBREW_BUNDLE_FILE
#     $XDG_CONFIG_HOME/brewfile/Brewfile
#     $HOME/.config/brewfile/Brewfile
#
if command_exists brew; then
    # Brew doesn't tend to run correctly as root
    if [ "$(whoami)" != "root" ]; then
        file=${HOMEBREW_BUNDLE_FILE:-${XDG_CONFIG_HOME:-$HOME/.config}/brewfile/Brewfile}
        if [ -r "$file" ]; then
            ( brew bundle -file="$file" )
        fi
    fi
fi
